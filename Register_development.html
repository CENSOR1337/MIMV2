<!DOCTYPE html>
<html lang="en">

<head>
	<title>ระบบสมัครใช้งานระบบอินเตอร์เน็ต</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--===============================================================================================-->
	<link rel="icon" type="image/png" href="images/icons/favicon.ico" />
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="./css/util.css">
	<link rel="stylesheet" type="text/css" href="./css/main.css">
	<link rel="stylesheet" type="text/css" href="./css/font.css">
	<script src='https://cdn.jsdelivr.net/npm/sweetalert2'></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
		integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
	<!--===============================================================================================-->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="css/materialize.css" media="screen,projection" />
	<link href="https://fonts.googleapis.com/css2?family=Sarabun&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>

<body>

	<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100">
				<div class="login100-pic">

					<div class="vertical-center">
						<center>
							<img src="images/student.png" alt="IMG" width="316px">
							<span class="login100-form-title">
								<br>
								<font style="font-size: 18px;">ระบบลงทะเบียนใช้งานระบบอินเตอร์เน็ต</font><br>
								<font style="font-size: 18px;">โรงเรียนเมืองยมวิทยาคาร</font><br>
							</span>
						</center>
					</div>
				</div>

				<form action="./PHPFunction/Register.php" method="POST" class="login100-form">
					<span class="login100-form-title">
						ระบบลงทะเบียน
					</span>

					<div id="Form_1" class="vertical-center-form" style="padding-top: 15%;">
						<div class="wrap-input100">
							<div class="row">
								<div class="input-field col s6">
									<input name="Firstname" id="Firstname" type="text" class="validate">
									<label for="Firstname">ชื่อ</label>
								</div>
								<div class="input-field col s6">
									<input name="Lastname" id="Lastname" type="text" class="validate">
									<label for="Lastname">นามสกุล</label>
								</div>
							</div>
							<div class="row">
								<div class="input-field col s6">
									<input name="Identify" maxlength="13" id="Identify" type="text" class="validate"
										oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
										onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))" />
									<label for="Identify">เลขประจำตัวประชาชน 13 หลัก</label>
								</div>
							</div>
							<div class="row">

								<div class="input-field col s12">
									<center>
										<div style="display: none;" id="LoadingBar" class="progress">
											<div class="indeterminate"></div>
										</div>
										<button id="CheckIDButton" class="btn waves-effect waves-light deep-purple"
											type="button" onclick="QueryIdentifyID();">เริ่มลงทะเบียน</button>
									</center>
								</div>
							</div>
						</div>
					</div>


					<div id="Form_2" style="display: none;">
						<div class="row">
							<div class="input-field col s12">
								<input name="Email" id="Email" type="email" class="validate">
								<label for="Email">อีเมล</label>
							</div>
						</div>
						<div class="row">
							<div class="input-field col s12">
								<select id="Gender" name="Gender">
									<option selected  disabled>เพศ</option>
									<option value="male">ชาย</option>
									<option value="female">หญิง</option>
								</select>
								<label>เพศ</label>
							</div>
						</div>
						<div class="row">
							<div class="input-field col s4">

								<select name="BirthDays" id="BirthDays">
									<option value="" disabled selected>วัน</option>
								</select>
								<label>วันเกิด</label>
							</div>
							<div class="input-field col s4 ">
								<select name="BirthMonths" id="BirthMonths">
									<option value="" disabled selected>เดือน</option>

								</select>
							</div>
							<div class="input-field col s4">
								<select name="BirthYears" id="BirthYears">
									<option value="" disabled selected>ปี</option>
								</select>
							</div>
						</div>
						<div class="row">
							<div class="input-field col s4">
								<select name="AcademicYear" id="AcademicYear">
									<option value="" disabled selected>ปีการศึกษา</option>
								</select>
								<label>ปีการศึกษา</label>
							</div>
							<div class="input-field col s4">
								<select name="Degree" id="Degree">
									<option value="" disabled selected>ระดับชั้น</option>
								</select>
							</div>
							<div class="input-field col s4">
								<select name="Room" id="Room">
									<option value="" disabled selected>ห้อง</option>
								</select>
							</div>
						</div>
						<div class="row">
							<div class="input-field col s6">
								<center>
									<button class="btn waves-effect waves-light deep-purple" type="button"
										onclick="doRegistion();">ลงทะเบียนใช้งาน</button>
								</center>
							</div>
							<div class="input-field col s6">
								<center>
									<button class="btn waves-effect waves-light red darken-1" type="button"
										onclick="StartChangeContent('Form_2','Form_1'); ToggleForm_1(true);">ยกเลิกการลงทะเบียน</button>
								</center>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>

	<div style="display: none;">
		<input type="text" id="StudentID" value="">
	</div>

	<div id="MismatchTable" style="display: none;">
		<table border="1" width="50%" style="border: 0%;">
			<thead>
				<tr>
					<td class="right">ชื่อที่ปรากฏในระบบ :&nbsp;</td>
					<td id='MismatchName' align="left">&nbsp;เมธี ตนะทิพย์</td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td class="right">ชื่อจากแบบฟอร์ม :&nbsp;</td>
					<td id='FormMismatchName' align="left">&nbsp;Metee Tanathip</td>
				</tr>
				<tr>
					<td colspan="2" align="center">
						<center>ต้องการแก้ไขชื่อตามแบบฟอร์มหรือไม่</center>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<!--<body onload="DataMismatch('asdfadf','sdfasdf','asdfasdf');">	
	</body> --->
	<script>
		// SweetAlert 2

		function registionSuccess(firstname, lastname) {
			Swal.fire({
				icon: 'success',
				title: firstname + ' ' + lastname,
				text: 'ได้ทำการลงทะเบียนไปเรียบร้อยแล้ว',
				footer: 'หากต้องการแก้ไขข้อมูลกรุณาเข้าสู่ระบบ',
				confirmButtonText: 'เข้าใจแล้ว'
			}).then((result) => {
				StartChangeContent('Form_2', 'Form_1');
				ToggleLoadingBar(false);
				ToggleForm_1(true);
			})
		};

		function DataMismatch(Identify, Firstname, Lastname) {
			FormIdentify = document.getElementById('Identify').value;
			FormFirstname = document.getElementById('Firstname').value;
			FormLastname = document.getElementById('Lastname').value;

			document.getElementById('MismatchName').innerText = Firstname + " " + Lastname;
			document.getElementById('FormMismatchName').innerText = FormFirstname + " " + FormLastname;

			Swal.fire({
				title: 'ชื่อไม่เหมือนกัน',
				showDenyButton: true,
				showCancelButton: true,
				confirmButtonText: `ใช่`,
				denyButtonText: `ไม่`,
				cancelButtonText: "ยกเลิก",
				html: document.getElementById('MismatchTable').innerHTML,
			}).then((result) => {
				/* Read more about isConfirmed, isDenied below */
				if (result.isConfirmed) {
					Swal.fire({
						title: FormFirstname + ' ' + FormLastname,
						text: 'คุณต้องการใช้ชื่อนี้การลงทะเบียนใช่หรือไม่',
						showDenyButton: true,
						showCancelButton: true,
						confirmButtonText: `ใช่`,
						denyButtonText: `ไม่`,
						cancelButtonText: "ยกเลิก",
					}).then((result) => {

						if (result.isConfirmed) {
							ToggleLoadingBar(false);
							StartChangeContent("Form_1", "Form_2");
						} else if (result.isDenied) {
							DataMismatch(Identify, Firstname, Lastname);
						} else {
							ToggleLoadingBar(false);
							ToggleForm_1(true);
						}
					})
				} else if (result.isDenied) {
					Swal.fire({
						title: Firstname + ' ' + Lastname,
						text: 'คุณต้องการใช้ชื่อนี้การลงทะเบียนใช่หรือไม่',
						showDenyButton: true,
						showCancelButton: true,
						confirmButtonText: `ใช่`,
						denyButtonText: `ไม่`,
						cancelButtonText: "ยกเลิก",
					}).then((result) => {
						if (result.isConfirmed) {
							document.getElementById('Firstname').value = Firstname;
							document.getElementById('Lastname').value = Lastname;
							ToggleLoadingBar(false);
							StartChangeContent("Form_1", "Form_2");
						} else if (result.isDenied) {
							DataMismatch(Identify, Firstname, Lastname);
						} else {
							ToggleLoadingBar(false);
							ToggleForm_1(true);
						}
					})
				} else {
					ToggleLoadingBar(false);
					ToggleForm_1(true);
				}
			})
		};

		function registered() {
			Swal.fire({
				icon: 'info',
				title: (document.getElementById('Identify').value),
				text: 'รหัสประจำตัวนี้ถูกลงทะเบียนไว้เรียบร้อยแล้ว',
				footer: 'หากมีปัญหากรุณาติดต่อผู้ดูแล',
				confirmButtonText: 'เข้าใจแล้ว',
			})
		};

		function ErrorAjax() {
			Swal.fire(
				'เกิดข้อผิดพลาด',
				'เกิดข้อผิดพลาดที่ไม่คาดคิด',
				'error'
			)
		};

		function NotVerified(name, lastname) {
			Swal.fire(
				'ยังไม่ได้รับการยืนยัน',
				'คุณ ' + name + "  " + lastname + ' ยังไม่สามารถเข้าระบบได้',
				'error'
			)
		}


		function NotFoundData() {
			Swal.fire({
				icon: 'error',
				title: (document.getElementById('Identify').value),
				text: 'ไม่พบอยู่ในระบบฐานข้อมูล',
				footer: 'กรุณาตรวจสอบหมายเลขของคุณหรือติดต่อผู้ดูแลระบบ',
				confirmButtonText: 'เข้าใจแล้ว',
			})
		};

		function MissingInput() {
			Swal.fire({
				icon: 'warning',
				title: 'กรุณากรอกข้อมูลให้ครบถ้วน',
				confirmButtonText: 'เข้าใจแล้ว',
			})
		};
	</script>

	<script>
		function ToggleForm_1(boolean) {
			if (boolean) {
				document.getElementById('CheckIDButton').style.display = 'block';
				document.getElementById('Identify').disabled = false;
				document.getElementById('Firstname').disabled = false;
				document.getElementById('Lastname').disabled = false;
			} else {
				document.getElementById('CheckIDButton').style.display = 'none';
				document.getElementById('Identify').disabled = true;
				document.getElementById('Firstname').disabled = true;
				document.getElementById('Lastname').disabled = true;
			}

		}

		function ToggleLoadingBar(Boolean) {
			if (Boolean) {
				document.getElementById("LoadingBar").style.display = "block";
			} else {
				document.getElementById("LoadingBar").style.display = "none";
			}
		}

		function doRegistion() {

			Identify = document.getElementById('Identify').value;
			Firstname = document.getElementById('Firstname').value;
			Lastname = document.getElementById('Lastname').value;
			Email = document.getElementById('Email').value;
			Gender = document.getElementById('Gender').value;
			BirthDays = document.getElementById('BirthDays').value;
			BirthMonths = document.getElementById('BirthMonths').value;
			BirthYears = document.getElementById('BirthYears').value;
			AcademicYear = document.getElementById('AcademicYear').value;
			Degree = document.getElementById('Degree').value;
			Room = document.getElementById('Room').value;
			StudentID = document.getElementById('StudentID').value;


			if (!Identify || !Firstname || !Lastname || !Email || !Gender || !BirthDays || !BirthMonths || !BirthYears || !
				AcademicYear || !Degree || !Room) {
				MissingInput();
				return;
			}

			ToggleLoadingBar(true);
			ToggleForm_1(false);

			AjaxOBJ = $.ajax({
				type: "POST",
				url: "./PHPFunction/doRegistion.php",
				error: function (ts) {
					alert(ts.responseText);
					ToggleLoadingBar(false);
					ToggleForm_1(true);
				}, // or console.log(ts.responseText)
				dataType: "json",
				data: {
					Identify: Identify,
					StudentID: StudentID,
					Firstname: Firstname,
					Lastname: Lastname,
					Email: Email,
					Gender: Gender,
					BirthDays: BirthDays,
					BirthMonths: BirthMonths,
					BirthYears: BirthYears,
					AcademicYear: AcademicYear,
					Degree: Degree,
					Room: Room
				}
			});

			AjaxOBJ.done(function (ResponsedMsg) {
				switch (ResponsedMsg['Status']) {
					case "success":
						registionSuccess(Firstname, Lastname);
						StartChangeContent("Form_1", "Form_2");
						ToggleForm_1(true);
						break;
					case 'registered':
						registered(Firstname, Lastname);
						ToggleLoadingBar(false);
						ToggleForm_1(true);
						break;
				}
			});

			AjaxOBJ.fail(function () {
				alert(ResponsedMsg[0]);
			});


		};


		function QueryIdentifyID() {

			Identify = document.getElementById('Identify').value;
			Firstname = document.getElementById('Firstname').value;
			Lastname = document.getElementById('Lastname').value;

			if (!Identify || !Firstname || !Lastname) {
				MissingInput();
				return;

			}

			ToggleLoadingBar(true);
			ToggleForm_1(false);

			AjaxOBJ = $.ajax({
				type: "POST",
				url: "./PHPFunction/QueryProfileIdentify.php",
				error: function (ts) {
					alert(ts.responseText);
					ToggleLoadingBar(false);
					ToggleForm_1(true);
				}, // or console.log(ts.responseText)
				dataType: "json",
				data: {
					Identify: Identify,
					Firstname: Firstname,
					Lastname: Lastname
				}
			});

			AjaxOBJ.done(function (ResponsedMsg) {
				if (ResponsedMsg) {
					document.getElementById('StudentID').value = ResponsedMsg['StudentID'];
					switch (ResponsedMsg['Status']) {
						case "success":
							ToggleLoadingBar(false);
							StartChangeContent("Form_1", "Form_2");
							break;
						case 'mismatch':
							DataMismatch(ResponsedMsg['Identify'], ResponsedMsg['Firstname'], ResponsedMsg[
								'Lastname']);
							break;
						case 'notFound':
							NotFoundData();
							ToggleLoadingBar(false);
							ToggleForm_1(true);
							break;
						case 'registered':
							registered();
							ToggleLoadingBar(false);
							ToggleForm_1(true);
							break;

					}
				} else {
					alert("Error!");
				}
			});

			AjaxOBJ.fail(function () {
				ToggleLoadingBar(false);
				ToggleForm_1(true);
			});

		};

		function EndChangeContent(ID, Value) {
			document.getElementById(ID).style.display = "none";
			var element = document.getElementById(Value);
			element.style.display = "block";
			element.classList.remove("animate__zoomOut");
			element.classList.add("animate__animated");
			element.classList.add("animate__zoomIn");
			console.log("Work!!");
		}


		function StartChangeContent(ID, Value) {
			var element = document.getElementById(ID);
			element.classList.add("animate__animated");
			element.classList.add("animate__zoomOut");
			setTimeout(() => {
				EndChangeContent(ID, Value);
			}, 500);
		}
	</script>

	<!--===============================================================================================-->
	<script src="./vendor/fullpage/fullpage.js"></script>
	<script src="vendor/jquery/jquery-3.5.1.min.js"></script>
	<script type="text/javascript" src="js/materialize.min.js"></script>
	<!--===============================================================================================-->

	<script>
		// init select of materilize css
		$(document).ready(function () {
			$('select').formSelect();
		});
		$(".dropdown-trigger").dropdown({
			coverTrigger: false
		});


		function AddIntoSelect(SelectID, Value, Text) {
			if (!(!SelectID || !Value || !Text)) {
				var x = document.getElementById(SelectID);
				var option = document.createElement("option");
				option.value = Value;
				option.text = Text;
				x.add(option);
			}
		}

		var months_th = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม",
			"กันยายน",
			"ตุลาคม", "พฤศจิกายน", "ธันวาคม",
		];
		var months_th_mini = ["ม.ค.", "ก.พ.", "มี.ค.", "เม.ย.", "พ.ค.", "มิ.ย.", "ก.ค.", "ส.ค.", "ก.ย.", "ต.ค.", "พ.ย.",
			"ธ.ค.",
		];


		for (let i = 0; i < 5; i++) {
			AddIntoSelect("Room", i + 1, ("ห้อง " + (i + 1)));
		}

		for (let i = 0; i < 6; i++) {
			AddIntoSelect("Degree", i + 1, ("มัธยมปีที่ " + (i + 1)));
		}


		for (let i = 0; i < months_th.length; i++) {
			const element = months_th[i];
			AddIntoSelect("BirthMonths", i + 1, element);
		}
		for (let i = 0; i < 31; i++) {
			AddIntoSelect("BirthDays", i + 1, i + 1);
		}
		let date = new Date().getFullYear();

		for (let i = 0; i < 50; i++) {
			AddIntoSelect("BirthYears", date - (i), (date - (i)) + 543);
			if (!(i > 10)) {
				AddIntoSelect("AcademicYear", date - (i), ((date - (i) + 543)));

			}
		}
		// Debug
		//StartChangeContent("Form_1", "Form_2");
	</script>
	<!--===============================================================================================-->
	<!--JavaScript at end of body for optimized loading-->

</body>

</html>